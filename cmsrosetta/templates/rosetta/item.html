{% extends "rosetta/base.html" %}{% load admin_static %}
{% load future rosetta i18n %}

{% block header %}
  {{ block.super }}
  <div id="user-tools">
    <p>
      <span>
        <a href="{% url 'rosetta-upload' pofile.app.kind pofile.app.name %}">{% trans "Upload catalog" %}</a> /
        <a href="{% url 'rosetta-download' pofile.app.kind pofile.app.name %}">{% trans "Download this catalog" %}</a>
      </span>
    </p>
  </div>
{% endblock %}

{% block pagetitle %}{{ block.super }}
  - {{ pofile.app.kind|title }}
  - {{ pofile.app.name|title }}
({{ pofile.percent_translated|floatformat:0 }}%){% endblock %}

{% block breadcumbs %}
  &rsaquo; <a href="{% url 'rosetta-list' pofile.app.kind %}">{{ pofile.app.kind|title }}</a>
  &rsaquo; {{ pofile.app.name|title }} ({{ pofile.percent_translated|floatformat:2 }}%)
{% endblock %}

{% block main %}
  {% autopaginate entries msg_per_page as items %}
  <h1>{% blocktrans  %}Translate into {{ language_name }}{% endblocktrans %}</h1>

  <ul class="object-tools">
    <li class="nobubble">{% trans "Display:" %}</li>
    {% for f in pofile.filters %}
      <li {% if filter == f.0 %}class="active"{% endif %}>
        <a href="?filter={{ f.0 }}">{{ f.1 }}</a>
      </li>
    {% endfor %}
  </ul>

    <div id="changelist" class="module">
      <div id="toolbar">
        <form id="changelist-search" action="" method="post">
          <div>
            {% rosetta_csrf_token %}
            <label for="searchbar"><img src="{% static "admin/img/icon_searchbox.png" %}" alt="{% trans "Search" %}" /></label>
            <input type="text" size="40" name="query" value="{{ query }}" id="searchbar" tabindex="0" />
            <input type="submit" name="search" value="{% trans "Go" %}" />
          </div>
        </form>
      </div>
      <form method="post" action="">
        <table>
          <thead>
            <tr>
              {% rosetta_csrf_token %}
              <th><div class="text">{% trans "Original" %}</div></th>
              <th>{{ language_name }}</th>
              <th class="c fuzzy"><span class="checkall">[-]</span> {% trans "Fuzzy" %}</th>
              <th class="c occur">{% trans "Occurrences(s)" %}</th>
            </tr>
          </thead>
          <tbody>
            {% for message in items %}
              <tr class="{% cycle "row1" "row2" %}">
                {% if message.msgid_plural %}
                  <td class="original plural">
                    <div class="plural-container">
                      <span class="part">{{message.msgid|format_message|linebreaksbr}}</span>
                      <span class="part">{{message.msgid_plural|format_message|linebreaksbr}}</span>
                    </div>

                    {% if message.msgctxt %}
                      <span class="context">{% trans "Context hint" %}: {{message.msgctxt|safe}}</span>
                    {% else %}
                      {% if message.comment %}
                        <span class="context">{% trans "Context hint" %}: {{message.comment|safe}}</span>
                      {% endif %}
                    {% endif %}
                  </td>
                  <td class="translation">
                    {% for k, msgstr in message.msgstr_plural.items|dictsort:"0"  %}
                      <label for="m_{{message.md5hash}}_{{k}}">{{k}}:</label>
                      <textarea rows="{{message.msgid|format_message|lines_count}}" cols="40" id="{{ message.md5hash }}_msg_{{ k }}" name="{{ message.md5hash }}_msgs_{{ k }}" tabindex="{% increment tab_idx %}">{{msgstr}}</textarea>
                    {% endfor %}
                  </td>
                {% else %}
                  <td class="original">
                    <span class="message">{{ message.msgid|format_message|linebreaksbr }}</span>
                    {% if message.msgctxt %}
                      <span class="context">{% trans "Context hint" %}: "{{message.msgctxt|safe}}"</span>
                    {% else %}
                      {% if message.comment %}
                        <span class="context">{% trans "Context hint" %}: {{message.comment|safe}}</span>
                      {% endif %}
                    {% endif %}
                  </td>
                  <td class="translation">
                    <textarea rows="{{message.msgid|format_message|lines_count}}" cols="40" name="{{ message.md5hash }}_msg" tabindex="{% increment tab_idx %}">{{message.msgstr}}</textarea>
                    {% if ENABLE_TRANSLATION_SUGGESTIONS %}
                      <a href="#" class="suggest">{% trans "suggest" %}</a>
                    {% endif %}
                  </td>
                {% endif %}
                <td class="c">
                  <input type="checkbox" name="{{message.md5hash}}_fuzzy" value="1" {% if message|is_fuzzy %}checked="checked"{% endif %} />
                </td>
                <td class="location">
                  {% for fn,lineno in message.occurrences %}
                    <code{% if forloop.counter|gt:"3" %} class="hide"{% endif %}>{{ fn }}:{{lineno}}</code>
                  {% endfor %}
                  {% if message.occurrences|length|gt:"3" %}
                    <a href="#">&hellip; ({% blocktrans count message.occurrences|length|minus:"3" as more_count %}{{more_count}} more{% plural %}{{more_count}} more{% endblocktrans %})</a>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
        {% if query %}
          <input type="hidden" name="query" value="{{query}}"  />
        {% endif %}
        <div class="submit-row">
          {% paginate %}
          <button type="submit" class="button default" tabindex="{% increment tab_idx %}"
            {% if page_obj.has_next %}
              name="save" value="{{ page|add:1 }}">{% trans "Save and Next Page" %}
            {% else %}
              name="save" value="0">{% trans "Save and Quit" %}
            {% endif %}
          </button>
        </div>
      </form>
    </div>
{% endblock %}
